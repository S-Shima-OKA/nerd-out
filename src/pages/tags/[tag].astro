---
import Layout from '../../layouts/Layout.astro';
import PageTitle from '../../components/PageTitle.astro';
import BlogPost from '../../components/BlogPost.astro';
import { itemSort, releasedSort } from '../../utils/util';
export async function getStaticPaths() {
    const allPosts = await Astro.glob('../article/items/*.md');
    const releasedPosts = releasedSort(allPosts); //draft = 下書きじゃない記事を抽出。
    const uniqueTags = [...new Set(releasedPosts.map((post) => post.frontmatter.tags).flat())];

    return uniqueTags.map((tag) => {
        const filteredPosts = releasedPosts.filter((post) => post.frontmatter.tags.includes(tag));
        itemSort(filteredPosts);
        return {
        params: { tag },
        props: { posts: itemSort(filteredPosts) },
        };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---
<Layout title={`${tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase()}の記事一覧`}>
    <PageTitle title=`${tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase()}` lead=`「${tag.charAt(0).toUpperCase() + tag.slice(1).toLowerCase()}」の記事一覧` />
    <BlogPost sortFunc={posts} />
</Layout>